<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ | Warehouse Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .summary-card {
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      padding: 15px 20px;
      margin-bottom: 20px;
      background: #bdd0f3;
    }
    .summary-title { font-size: 0.9rem; color: #6c757d; }
    .summary-value { font-size: 1.25rem; font-weight: bold; margin-top: 5px; }
    .table-container { overflow-x: auto; }
    .lang-wrap { display:flex; justify-content:flex-end; align-items:center; gap:.5rem; }
  </style>
</head>
<body class="container py-4">

  <!-- Top bar: Back + Language -->
  <div class="mb-3 lang-wrap">
    <a href="{{ url_for('user_views.home') }}" class="btn btn-outline-secondary"
       data-hi="‚Üê ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•É‡§∑‡•ç‡§† ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç"
       data-en="‚Üê Back to Home">‚Üê ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•É‡§∑‡•ç‡§† ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç</a>

    <select id="langSwitcher" class="form-select form-select-sm" style="width:auto">
      <option value="hi" selected>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
      <option value="en">English</option>
    </select>
  </div>

  <h3 class="mb-4 text-center"
      data-hi="üì¶ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤"
      data-en="üì¶ Seller Module">üì¶ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤</h3>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-4" id="sellerTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="materials-tab" data-bs-toggle="tab" data-bs-target="#materials" type="button" role="tab"
              data-hi="üßæ ‡§¨‡•á‡§ö‡•á ‡§ó‡§è ‡§∏‡§æ‡§Æ‡§æ‡§®" data-en="üßæ Materials Sold">üßæ ‡§¨‡•á‡§ö‡•á ‡§ó‡§è ‡§∏‡§æ‡§Æ‡§æ‡§®</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="payments-tab" data-bs-toggle="tab" data-bs-target="#payments" type="button" role="tab"
              data-hi="üí∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®" data-en="üí∞ Payments Received">üí∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="due-tab" data-bs-toggle="tab" data-bs-target="#due" type="button" role="tab"
              data-hi="üí∏ ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®" data-en="üí∏ Payment Due">üí∏ ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®</button>
    </li>
  </ul>

  <div class="tab-content" id="sellerTabContent">

    <!-- Materials Sold -->
    <div class="tab-pane fade show active" id="materials" role="tabpanel" aria-labelledby="materials-tab">
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="summary-card">
            <div class="summary-title" data-hi="‡§ï‡•Å‡§≤ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ" data-en="Total Quantity">‡§ï‡•Å‡§≤ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ</div>
            <div class="summary-value">{{ purchase_summary.quantity | round(2) | kg_to_mt }}</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="summary-card">
            <div class="summary-title" data-hi="‡§ï‡§ü‡•å‡§§‡•Ä" data-en="Reduction">‡§ï‡§ü‡•å‡§§‡•Ä</div>
            <div class="summary-value">{{ purchase_summary.reduction | round(2) | kg_to_mt }}</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="summary-card">
            <div class="summary-title" data-hi="‡§∂‡•Å‡§¶‡•ç‡§ß ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ" data-en="Net Quantity">‡§∂‡•Å‡§¶‡•ç‡§ß ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ</div>
            <div class="summary-value">{{ purchase_summary.net_qty | round(2) | kg_to_mt }}</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="summary-card">
            <div class="summary-title" data-hi="‡§≤‡§æ‡§ó‡§§" data-en="Cost">‡§≤‡§æ‡§ó‡§§</div>
            <div class="summary-value">{{ purchase_summary.cost | round(2) | format_inr }}</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="summary-card">
            <div class="summary-title" data-hi="‡§π‡•à‡§Ç‡§°‡§≤‡§ø‡§Ç‡§ó ‡§∂‡•Å‡§≤‡•ç‡§ï" data-en="Handling Charges">‡§π‡•à‡§Ç‡§°‡§≤‡§ø‡§Ç‡§ó ‡§∂‡•Å‡§≤‡•ç‡§ï</div>
            <div class="summary-value">{{ purchase_summary.handling | round(2) | format_inr }}</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="summary-card">
            <div class="summary-title" data-hi="‡§ï‡•Å‡§≤ ‡§≤‡§æ‡§ó‡§§" data-en="Total Cost">‡§ï‡•Å‡§≤ ‡§≤‡§æ‡§ó‡§§</div>
            <div class="summary-value">{{ purchase_summary.net_cost | round(2) | format_inr }}</div>
          </div>
        </div>
      </div>

      <div class="table-container">
        <table class="table table-striped table-bordered table-sm align-middle">
          <thead class="table-dark">
            <tr>
              <th data-hi="‡§§‡§ø‡§•‡§ø" data-en="Date">‡§§‡§ø‡§•‡§ø</th>
              <th data-hi="‡§Ü‡§∞‡§è‡§∏‡§ü‡•Ä ‡§®‡§Ç." data-en="RST No">‡§Ü‡§∞‡§è‡§∏‡§ü‡•Ä ‡§®‡§Ç.</th>
              <th data-hi="‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏" data-en="Warehouse">‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏</th>
              <th data-hi="‡§µ‡§∏‡•ç‡§§‡•Å" data-en="Commodity">‡§µ‡§∏‡•ç‡§§‡•Å</th>
              <th data-hi="‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)" data-en="Qty (in kg)">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)</th>
              <th data-hi="‡§ï‡§ü‡•å‡§§‡•Ä (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)" data-en="Reduction (in kg)">‡§ï‡§ü‡•å‡§§‡•Ä (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)</th>
              <th data-hi="‡§∂‡•Å‡§¶‡•ç‡§ß ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)" data-en="Net Qty (in kg)">‡§∂‡•Å‡§¶‡•ç‡§ß ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)</th>
              <th data-hi="‡§¶‡§∞" data-en="Rate">‡§¶‡§∞</th>
              <th data-hi="‡§≤‡§æ‡§ó‡§§" data-en="Cost">‡§≤‡§æ‡§ó‡§§</th>
              <th data-hi="‡§π‡•à‡§Ç‡§°‡§≤‡§ø‡§Ç‡§ó" data-en="Handling">‡§π‡•à‡§Ç‡§°‡§≤‡§ø‡§Ç‡§ó</th>
              <th data-hi="‡§ï‡•Å‡§≤" data-en="Total">‡§ï‡•Å‡§≤</th>
              <th data-hi="‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ" data-en="Quality">‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ</th>
            </tr>
          </thead>
          <tbody>
            {% for p in purchases %}
            <tr>
              <td>{{ p.date | format_date }}</td>
              <td>{{ p.rst_no }}</td>
              <td>{{ p.warehouse | to_hindi}}</td>
              <td>{{ p.commodity | to_hindi }}</td>
              <td>{{ p.quantity | round(2) }}</td>
              <td>{{ p.reduction }}</td>
              <td>{{ p.net_qty | round(2) }}</td>
              <td>{{ p.rate }}</td>
              <td>{{ p.cost | round(2) }}</td>
              <td>{{ p.handling }}</td>
              <td>{{ p.net_cost | round(2) }}</td>
              <td>{{ p.quality }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Payments Received -->
    <div class="tab-pane fade" id="payments" role="tabpanel" aria-labelledby="payments-tab">
      <div class="row mb-4">
        <div class="col-md-4 offset-md-4">
          <div class="summary-card text-center">
            <div class="summary-title" data-hi="‡§ï‡•Å‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®" data-en="Total Payments Received">‡§ï‡•Å‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®</div>
            <div class="summary-value text-success">{{ payment_summary.amount or 0 | round(2) }}</div>
          </div>
        </div>
      </div>

      <div class="table-container">
        <table class="table table-striped table-bordered table-sm align-middle">
          <thead class="table-dark">
            <tr>
              <th data-hi="‡§§‡§ø‡§•‡§ø" data-en="Date">‡§§‡§ø‡§•‡§ø</th>
              <th data-hi="‡§¨‡•à‡§Ç‡§ï ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠" data-en="Bank Reference">‡§¨‡•à‡§Ç‡§ï ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠</th>
              <th data-hi="‡§∞‡§æ‡§∂‡§ø" data-en="Amount">‡§∞‡§æ‡§∂‡§ø</th>
            </tr>
          </thead>
          <tbody>
            {% for pay in payments %}
            <tr>
              <td>{{ pay.date | format_date }}</td>
              <td>{{ pay.bank_reference }}</td>
              <td>{{ pay.amount_paid }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Payment Due -->
    <div class="tab-pane fade" id="due" role="tabpanel" aria-labelledby="due-tab">
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="summary-card text-center">
            <div class="summary-title" data-hi="‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø ‡§ï‡•Ä ‡§∂‡•Å‡§¶‡•ç‡§ß ‡§≤‡§æ‡§ó‡§§" data-en="Net Cost of Material Supplied">‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø ‡§ï‡•Ä ‡§∂‡•Å‡§¶‡•ç‡§ß ‡§≤‡§æ‡§ó‡§§</div>
            <div class="summary-value">{{ (net_cost or 0) | format_inr }}</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="summary-card text-center">
            <div class="summary-title" data-hi="‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§æ‡§∂‡§ø" data-en="Amount Paid">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§æ‡§∂‡§ø</div>
            <div class="summary-value text-success">{{ (amount_paid or 0) | format_inr }}</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="summary-card text-center">
            <div class="summary-title"
                 data-hi="‡§¶‡•á‡§Ø ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ({{ today }} ‡§§‡§ï)"
                 data-en="Payment Due (till {{ today }})">‡§¶‡•á‡§Ø ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ({{ today }} ‡§§‡§ï)</div>
            <div class="summary-value text-danger fw-bold">{{ (payment_due or 0) | format_inr }}</div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Language Toggle -->
  <script>
    (function () {
      const switcher = document.getElementById('langSwitcher');
      const applyLang = (lang) => {
        document.documentElement.setAttribute('lang', lang);
        document.querySelectorAll('[data-hi]').forEach(el => {
          const txt = el.getAttribute(lang === 'hi' ? 'data-hi' : 'data-en');
          if (txt !== null) el.innerHTML = txt;
        });
        // Update title as well
        const pageTitleHi = '‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ | Warehouse Portal';
        const pageTitleEn = 'Seller Module | Warehouse Portal';
        document.title = (lang === 'hi') ? pageTitleHi : pageTitleEn;
        // Persist choice for this browser
        try { localStorage.setItem('ui-lang', lang); } catch(e){}
      };

      // Restore saved language
      let lang = 'hi';
      try {
        lang = localStorage.getItem('ui-lang') || 'hi';
      } catch(e){}
      switcher.value = lang;
      applyLang(lang);

      switcher.addEventListener('change', function () {
        applyLang(this.value);
      });
    })();
  </script>
</body>
</html>
